name: compile_c
description: Compile and run C code in a sandboxed environment

build:
  package: ./getting-started/compile_c
  timeout: 30s

cli:
  timeout: 180s

cli_tests:
  - name: hello world
    args:
      - "-code"
      - |
        #include <stdio.h>

        int main() {
            printf("Hello, World!\n");
            return 0;
        }
    expect:
      exit_code: 0
      stdout_equals: "Hello, World!\n"

  - name: arithmetic
    args:
      - "-code"
      - |
        #include <stdio.h>

        int main() {
            printf("%d\n", 2 + 2);
            return 0;
        }
    expect:
      exit_code: 0
      stdout_equals: "4\n"

  - name: function call
    args:
      - "-code"
      - |
        #include <stdio.h>

        int add(int a, int b) {
            return a + b;
        }

        int main() {
            printf("%d\n", add(3, 5));
            return 0;
        }
    expect:
      exit_code: 0
      stdout_equals: "8\n"

  - name: array sum
    args:
      - "-code"
      - |
        #include <stdio.h>

        int main() {
            int nums[] = {1, 2, 3, 4, 5};
            int sum = 0;
            for (int i = 0; i < 5; i++) {
                sum += nums[i];
            }
            printf("%d\n", sum);
            return 0;
        }
    expect:
      exit_code: 0
      stdout_equals: "15\n"

  - name: compile error
    args:
      - "-code"
      - |
        #include <stdio.h>

        int main() {
            undefined_function();
            return 0;
        }
    expect:
      exit_code: 1
      stderr_contains: "undefined"

  - name: missing argument
    args: []
    expect:
      exit_code: 1
      stderr_contains: "must provide"
